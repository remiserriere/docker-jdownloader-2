#!/bin/sh
# Wrapper script to safely kill OpenVPN processes only
# This script validates that the PID belongs to an openvpn process before killing it

set -e

if [ $# -eq 0 ]; then
    echo "Usage: $0 [-9] <pid>" >&2
    exit 1
fi

SIGNAL=""
PID=""

# Parse arguments
if [ "$1" = "-9" ]; then
    SIGNAL="-9"
    PID="$2"
else
    PID="$1"
fi

# Validate PID is numeric
if ! echo "$PID" | grep -qE '^[0-9]+$'; then
    echo "Error: PID must be numeric" >&2
    exit 1
fi

# Check if the process exists and is an openvpn process
if [ ! -d "/proc/$PID" ]; then
    echo "Error: Process $PID does not exist" >&2
    exit 1
fi

# Get the process command
PROC_CMD=$(cat "/proc/$PID/comm" 2>/dev/null || echo "")

if [ "$PROC_CMD" != "openvpn" ]; then
    echo "Error: Process $PID is not an openvpn process (found: $PROC_CMD)" >&2
    exit 1
fi

# Kill the process
if [ -n "$SIGNAL" ]; then
    kill -9 "$PID"
else
    kill "$PID"
fi
